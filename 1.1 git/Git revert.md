# 	Git revert

 最近遇到了一些复杂的回退MR 问题，在这里整理一下revert的相关操作。



在使用 `git revert` 撤销多个提交时，默认会为每个撤销操作生成一个单独的提交记录（如 `Revert "原提交信息"`）。如果你希望 **合并多个 revert 提交** 或 **自定义提交信息**，可以通过以下方法灵活控制：

---

#### **方法 1：合并多个 revert 提交（推荐）**
#### **适用场景**  
需要一次性撤销多个提交，并希望生成 **一个** 合并的 revert 提交（而不是每个提交对应一个 revert）。

#### **步骤**  
1. **使用 `-n`（或 `--no-commit`）选项**，让 `git revert` 只应用更改但不自动提交：
   ```bash
   git revert -n <commit1> <commit2> <commit3>  # 撤销多个提交，但不提交
   ```
   - 例如：
     ```bash
     git revert -n abc123 def456 xyz789
     ```

2. **手动提交所有更改**，并编写统一的提交信息：
   ```bash
   git commit -m "revert: 撤销子MR1、子MR2、子MR3的更改"
   ```

#### **优点**  
✅ 生成一个清晰的 revert 提交，避免历史记录冗余。  
✅ 可自定义提交信息，便于团队理解。  

#### **注意事项**  
⚠️ 如果多个 revert 之间存在冲突，需手动解决后再提交。

---

#### **方法 2：交互式编辑提交信息**
#### **适用场景**  
希望为每个 revert 提交 **单独修改默认的提交信息**。

#### **步骤**  
1. 使用 `-e`（或 `--edit`）选项，在生成 revert 提交时进入编辑器修改信息：
   ```bash
   git revert -e <commit1> <commit2>  # 对每个提交单独编辑信息
   ```
   - Git 会依次为每个提交打开编辑器，允许你修改默认的 `Revert "..."` 消息。

2. 保存退出后，提交生效。

#### **示例**  
默认生成的提交信息：
```
Revert "fix: 修复按钮点击问题"
```
可修改为：
```
revert: 回退按钮修复（因引入新BUG）
```

#### **优点**  
✅ 可精细化控制每个 revert 提交的描述。  

---

#### **方法 3：直接修改历史提交（谨慎使用）**
#### **适用场景**  
已生成多个 revert 提交，但希望合并或修改它们（需重写历史，**仅限本地或未推送的分支**）。

#### **步骤**  
1. 使用 `git rebase -i` 交互式变基：
   ```bash
   git rebase -i HEAD~5  # 修改最近5个提交
   ```
2. 将多余的 revert 提交标记为 `squash`（合并）或 `reword`（修改信息）：
   ```
   pick abc123 Revert "子MR1"
   squash def456 Revert "子MR2"  # 合并到上一个提交
   reword xyz789 Revert "子MR3"  # 仅修改该提交信息
   ```
3. 保存后按提示操作。

#### **注意事项**  
⚠️ **会重写提交历史**，已推送的分支需强制推送（`git push --force`），可能影响协作。  

---

#### **方法 4：自定义默认的 revert 提交信息模板**
#### **适用场景**  
希望统一所有 revert 提交的格式。

#### **步骤**  
1. 通过 Git 配置设置提交模板：
   ```bash
   git config --global revert.template "revert: %s\n\nThis reverts commit %H."
   ```
   - `%s`：原提交信息；`%H`：原提交哈希。  
2. 执行 `git revert` 时会自动套用模板。

---

#### **总结**
| **需求**                 | **方法**                      | **是否重写历史** |
| ------------------------ | ----------------------------- | ---------------- |
| 合并多个 revert 提交     | `git revert -n` + 手动提交    | ❌ 否             |
| 单独编辑每个 revert 信息 | `git revert -e`               | ❌ 否             |
| 修改已生成的 revert 提交 | `git rebase -i`（交互式变基） | ✅ 是             |
| 统一 revert 信息格式     | 配置 `revert.template`        | ❌ 否             |

#### **推荐选择**
- **团队协作分支**：优先用 **方法 1**（`git revert -n` + 手动提交），安全且清晰。  
- **本地分支**：可用 **方法 3**（`rebase -i`）整理历史。  
- **精细化控制**：用 **方法 2**（`-e` 编辑）或 **方法 4**（模板）。  

通过合理选择，可以高效管理 revert 提交的日志可读性！